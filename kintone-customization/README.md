# Kintone customization

- [Kintone customization](#kintone-customization)
  - [Summary](#summary)
  - [Using this definition with an existing folder](#using-this-definition-with-an-existing-folder)
  - [How it works](#how-it-works)
    - [DevServer](#devserver)
    - [Example NPM packages I choose here for root level](#example-npm-packages-i-choose-here-for-root-level)
    - [Sample project folders](#sample-project-folders)
      - [Sample project folder for ES5: `sample-project-es5`](#sample-project-folder-for-es5-sample-project-es5)
      - [Sample project folder for ES6: `sample-project-es6`](#sample-project-folder-for-es6-sample-project-es6)
      - [Sample project folder for TypeScript: `sample-project-ts`](#sample-project-folder-for-typescript-sample-project-ts)
  - [License](#license)

## Summary

*Develop Kintone JavaScript customization, Kintone Plug-ins, Node.js applications in Node.js and Python. Includes Node.js 14, ESLint, Python 3.7, and related extensions and dependencies.*

| Metadata | Value |
|----------|-------|
| *Contributors* | [@yamaryu0508](https://twitter.com/yamaryu0508) |
| *Definition type* | Dockerfile |
| *Languages, platforms* | JavaScript, Node.js, TypeScript, Python |

## Using this definition with an existing folder

Just follow these steps:

1. If this is your first time using a development container, please follow the [getting started steps](https://aka.ms/vscode-remote/containers/getting-started) to set up your machine.

2. To use VS Code's copy of this definition:
   1. Start VS Code and open your project folder.
   2. Press <kbd>F1</kbd> select and **Remote-Containers: Add Development Container Configuration Files...** from the command palette.
   3. Select the Dart definition.

3. To use latest-and-greatest copy of this definition from the repository:
   1. Clone this repository.
   2. Copy the contents of `vscode-dev-containers/kintone-customization/.devcontainer` to the root of your project folder.
   3. Start VS Code and open your project folder.

4. After following step 2 or 3, the contents of the `.devcontainer` folder in your project can be adapted to meet your needs.

5. Finally, press <kbd>F1</kbd> and run **Remote-Containers: Reopen Folder in Container** to start using the definition.

## How it works

### DevServer
DevServer can be used to quickly apply frontend JavaScript customizations. Run DevServer as bellow.
```:shell
sh run-devserver.sh
```

When the server is started, we can access like this from the browsers.
```:shell
https://localhost:8443/sample-project-es5/frontend/apps/sample-app/desktop.js
```

The certificates for locally-trusted development are generated by [mkcert](https://github.com/FiloSottile/mkcert).

```:shell
.devcontainer/devserver/mkcert
 ├── .CAROOT/
 │   ├── rootCA-key.pem
 │   └── rootCA.pem
 ├── localhost+2-key.pem
 ├── localhost+2.pem
 ├── mkcert-v1.4.1-darwin-amd64
 ├── mkcert-v1.4.1-linux-amd64
 └── mkcert-v1.4.1-windows-amd64.exe
```

So we can access the JavaScript files while avoiding verification errors if we install Root CA on your local host machine. Follow the procedure below ([Reference](https://github.com/FiloSottile/mkcert#installing-the-ca-on-other-systems)).
- Specify the path of folder that includes `rootCA.pem` on your local machine
  - ex) `/Users/yamaryu0508/vscode-dev-containers/kintone-customization/.devcontainer/devserver/mkcert/.CAROOT`
- Set $CAROOT to its directory on your local machine
  - ex) `export CAROOT=/Users/yamaryu0508/vscode-dev-containers/kintone-customization/.devcontainer/devserver/mkcert/.CAROOT`
- Run `mkcert -install` on your local machine and type admin password to install Root CA
  - ex) `/Users/yamaryu0508/vscode-dev-containers/kintone-customization/.devcontainer/devserver/mkcert-v1.4.1-darwin-amd64 -install`

### Example NPM packages I choose here for root level
They allow us to handle `ES6+`, `TypeScript`, `ESLint`.

```:json
{
  "devDependencies": {
    "@babel/core": "^7.10.3",
    "@babel/plugin-proposal-class-properties": "^7.10.1",
    "@babel/preset-env": "^7.10.3",
    "@babel/preset-typescript": "^7.10.1",
    "@cybozu/eslint-config": "^11.0.0",
    "@kintone/dts-gen": "^3.0.5",
    "@typescript-eslint/eslint-plugin": "^3.4.0",
    "babel-loader": "^8.1.0",
    "core-js": "^3.6.5",
    "css-loader": "^3.6.0",
    "eslint": "^7.3.0",
    "eslint-config-prettier": "^6.11.0",
    "eslint-plugin-import": "^2.21.2",
    "eslint-plugin-prettier": "^3.1.4",
    "file-loader": "^6.0.0",
    "fork-ts-checker-webpack-plugin": "^5.0.4",
    "glob": "^7.1.6",
    "npm-run-all": "^4.1.5",
    "prettier": "^2.0.5",
    "regenerator-runtime": "^0.13.5",
    "style-loader": "^1.2.1",
    "typescript": "^3.9.5",
    "url-loader": "^4.1.0",
    "webpack": "^4.43.0",
    "webpack-cli": "^3.3.12"
  },
  "dependencies": {
    "core-js": "^3.6.4",
    "regenerator-runtime": "^0.13.5"
  }
}
```
### Sample project folders
Sample project folders for `ES5`, `ES6` and `TypeScript` are included. Each folder consists of `backend`, `frontend` and `plugins`.
```:shell
.
├── backend/
├── frontend/
│   ├── apps/
│   │   ├── common/
│   │   └── sample-app/
│   └── global/
│       ├── portal/
│       └── spaces/
└── plugins/
    └── sample-plugin/
```

- `backend`: can be used for backend development with Kintone REST APIs
- `frontend`: can be used for frontend JavaScript customization with Kintone JavaScript APIs
  - `apps`: for each Kintone app
  - `global`: for global customization like the portal
- `plugins`: can be used for Kintone plug-ins development

The `sample-app/desktop.js` & `portal/desktop.js` are provided as simple JavaScript customization examples, and `sample-plugin` has been created by cloning `@kintone/create-plugin` here.

#### Sample project folder for ES5: `sample-project-es5`
```:shell
sample-project-es5
├── backend
├── frontend
│   ├── apps
│   │   ├── common
│   │   │   └── SampleClassES5.js
│   │   └── sample-app
│   │       └── desktop.js
│   └── global
│       ├── portal
│       │   └── desktop.js
│       └── spaces
└── plugins
    └── sample-plugin
        ├── package.json
        ├── private.ppk
        ├── scripts
        │   └── npm-start.js
        └── src
            ├── css
            │   ├── 51-modern-default.css
            │   ├── config.css
            │   ├── desktop.css
            │   └── mobile.css
            ├── html
            │   └── config.html
            ├── image
            │   └── icon.png
            ├── js
            │   ├── config.js
            │   ├── desktop.js
            │   └── mobile.js
            └── manifest.json
```

#### Sample project folder for ES6: `sample-project-es6`
- `sample-app/desktop.js` & `portal/desktop.js` are bundled by `sample-project-es6/frontend/webpack.config.js`
- `sample-plugin` is bundled and packed by `sample-project-es6/plugins/sample-plugin/webpack.config.js`

```:shell
sample-project-es6
├── backend
├── frontend
│   ├── apps
│   │   ├── common
│   │   │   └── SampleClassES6.js
│   │   └── sample-app
│   │       └── desktop.js
│   ├── global
│   │   ├── portal
│   │   │   ├── 51-modern-default.css
│   │   │   └── desktop.js
│   │   └── spaces
│   └── webpack.config.js
└── plugins
    └── sample-plugin
        ├── package.json
        ├── plugin
        │   ├── html
        │   │   └── config.html
        │   ├── image
        │   │   └── icon.png
        │   ├── js
        │   │   ├── config.js
        │   │   ├── desktop.js
        │   │   └── mobile.js
        │   └── manifest.json
        ├── private.ppk
        ├── scripts
        │   └── npm-start.js
        ├── src
        │   ├── css
        │   │   ├── 51-modern-default.css
        │   │   ├── config.css
        │   │   ├── desktop.css
        │   │   └── mobile.css
        │   └── js
        │       ├── config.js
        │       ├── desktop.js
        │       └── mobile.js
        └── webpack.config.js
```

#### Sample project folder for TypeScript: `sample-project-ts`
- `sample-app/desktop.js` & `portal/desktop.js` are bundled by `sample-project-ts/frontend/webpack.config.js`
- `sample-plugin` is bundled and packed by `sample-project-ts/plugins/sample-plugin/webpack.config.js`

```:shell
sample-project-ts
├── backend
├── frontend
│   ├── apps
│   │   ├── common
│   │   │   └── SampleClassTS.ts
│   │   └── sample-app
│   │       ├── desktop.ts
│   │       └── fields.d.ts
│   ├── babel.config.js
│   ├── global
│   │   ├── portal
│   │   │   ├── 51-modern-default.css
│   │   │   └── desktop.ts
│   │   └── spaces
│   ├── tsconfig.json
│   └── webpack.config.js
└── plugins
    └── sample-plugin
        ├── babel.config.js
        ├── package.json
        ├── plugin
        │   ├── html
        │   │   └── config.html
        │   ├── image
        │   │   └── icon.png
        │   ├── js
        │   │   ├── config.js
        │   │   ├── desktop.js
        │   │   └── mobile.js
        │   └── manifest.json
        ├── private.ppk
        ├── scripts
        │   └── npm-start.js
        ├── src
        │   ├── css
        │   │   ├── 51-modern-default.css
        │   │   ├── config.css
        │   │   ├── desktop.css
        │   │   └── mobile.css
        │   └── ts
        │       ├── @types
        │       │   └── kintone.d.ts
        │       ├── config.ts
        │       ├── desktop.ts
        │       └── mobile.ts
        ├── tsconfig.json
        └── webpack.config.js
```

## License

Copyright (c) Ryu Yamashita. All rights reserved.

Licensed under the MIT License.
